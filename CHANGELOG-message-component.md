# Message ç»„ä»¶å¢å¼º - å˜æ›´æ—¥å¿—

## ç‰ˆæœ¬: 2.0.76-enhanced
**æ—¥æœŸ**: 2025-12-24

---

## ğŸ‰ ä¸»è¦æ›´æ–°

### å¢å¼ºçš„ Message ç»„ä»¶

å¯¹ `src/ui/components/Message.tsx` è¿›è¡Œäº†å…¨é¢å¢å¼ºï¼Œä½¿å…¶ç¬¦åˆå®˜æ–¹ Claude Code CLI æ ‡å‡†ã€‚

#### âœ¨ æ–°å¢åŠŸèƒ½

1. **æµå¼æ–‡æœ¬æ¸²æŸ“**
   - é€å­—ç¬¦æ˜¾ç¤ºï¼Œæ¨¡æ‹ŸçœŸå®æ‰“å­—æ•ˆæœ
   - å¯é…ç½®æ¸²æŸ“é€Ÿåº¦ï¼ˆ`streamSpeed` å±æ€§ï¼‰
   - æµå¼çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆâ‹¯ ç¬¦å·ï¼‰
   - å®Œæˆå›è°ƒæ”¯æŒï¼ˆ`onComplete`ï¼‰

2. **Markdown æ¸²æŸ“**
   - æ”¯æŒæ ‡é¢˜ï¼ˆ# - ######ï¼‰
   - æ”¯æŒåˆ—è¡¨ï¼ˆ-, *, +ï¼‰
   - æ”¯æŒä»£ç å—ï¼ˆ```ï¼‰
   - è‡ªåŠ¨è§£æå’Œæ ¼å¼åŒ–

3. **ä»£ç å—é«˜äº®**
   - ä¸“é—¨çš„ CodeBlock ç»„ä»¶
   - è¯­è¨€æ ‡ç­¾æ˜¾ç¤º
   - å¸¦è¾¹æ¡†æ ·å¼
   - é»„è‰²ä»£ç æ–‡æœ¬

4. **å·¥å…·è°ƒç”¨æ˜¾ç¤º**
   - ToolUseBlock ç»„ä»¶ï¼ˆå“çº¢è‰² ğŸ”§ï¼‰
   - ToolResultBlock ç»„ä»¶ï¼ˆâœ“/âœ— å›¾æ ‡ï¼‰
   - å‚æ•°å’Œç»“æœè‡ªåŠ¨æˆªæ–­
   - æ”¯æŒ ContentBlock æ•°ç»„

5. **å¤šè§’è‰²æ”¯æŒ**
   - `user` - è“è‰²
   - `assistant` - ç»¿è‰²
   - `system` - é’è‰²ï¼ˆæ–°å¢ï¼‰
   - `error` - çº¢è‰²ï¼ˆæ–°å¢ï¼‰

6. **å¢å¼ºçš„æ—¶é—´æˆ³**
   - ä¿ç•™åŸæœ‰åŠŸèƒ½
   - ä¼˜åŒ–æ˜¾ç¤ºæ ·å¼
   - ç°è‰²åŠé€æ˜

7. **æ¨¡å‹ä¿¡æ¯**
   - æ˜¾ç¤ºä½¿ç”¨çš„æ¨¡å‹åç§°
   - æ ¼å¼: "Claude (model-name)"

8. **å¤åˆ¶æç¤º**
   - `showCopyHint` å±æ€§
   - ä½¿ç”¨æç¤ºæ–‡æœ¬
   - ä»…åœ¨éæµå¼çŠ¶æ€æ˜¾ç¤º

#### ğŸ”§ æŠ€æœ¯æ”¹è¿›

**æ–°å¢å±æ€§**:
```typescript
interface MessageProps {
  role: 'user' | 'assistant' | 'system' | 'error';  // æ‰©å±•
  content: string | ContentBlock[];                  // æ‰©å±•
  timestamp?: Date;                                   // ä¿ç•™
  streaming?: boolean;                                // æ–°å¢
  streamSpeed?: number;                               // æ–°å¢
  showCopyHint?: boolean;                            // æ–°å¢
  model?: string;                                     // æ–°å¢
  onComplete?: () => void;                           // æ–°å¢
}
```

**æ–°å¢å†…éƒ¨ç»„ä»¶**:
- `CodeBlock` - ä»£ç å—æ¸²æŸ“
- `ToolUseBlock` - å·¥å…·è°ƒç”¨æ¸²æŸ“
- `ToolResultBlock` - å·¥å…·ç»“æœæ¸²æŸ“

**æ–°å¢è¾…åŠ©å‡½æ•°**:
- `parseMarkdownForTerminal()` - Markdown è§£æ
- `parseTextBlocks()` - æ–‡æœ¬å—è§£æ
- `renderContentBlocks()` - ContentBlock æ¸²æŸ“
- `getTextContent()` - æ–‡æœ¬æå–
- `getRoleLabel()` - è§’è‰²æ ‡ç­¾
- `getRoleColor()` - è§’è‰²é¢œè‰²

#### ğŸ“Š ä»£ç ç»Ÿè®¡

- **è¡Œæ•°**: 38 è¡Œ â†’ 389 è¡Œ
- **åŠŸèƒ½**: åŸºç¡€æ˜¾ç¤º â†’ å®Œæ•´æ¶ˆæ¯æ¸²æŸ“å™¨
- **ç»„ä»¶**: 1 ä¸ª â†’ 4 ä¸ªï¼ˆä¸»ç»„ä»¶ + 3 ä¸ªå­ç»„ä»¶ï¼‰
- **å±æ€§**: 3 ä¸ª â†’ 8 ä¸ª

#### ğŸ¨ æ ·å¼ç³»ç»Ÿ

**é¢œè‰²æ–¹æ¡ˆ**:
- ç”¨æˆ·: è“è‰² (blue)
- åŠ©æ‰‹: ç»¿è‰² (green)
- ç³»ç»Ÿ: é’è‰² (cyan)
- é”™è¯¯: çº¢è‰² (red)
- ä»£ç : é»„è‰² (yellow)
- æ ‡é¢˜: é’è‰²åŠ ç²— (cyan bold)
- åˆ—è¡¨: é»„è‰²ç¬¦å· (yellow â€¢)
- å·¥å…·: å“çº¢è‰² (magenta)

**å¸ƒå±€**:
- æ¶ˆæ¯é—´è·: marginY={1}
- å†…å®¹ç¼©è¿›: marginLeft={2}
- ä»£ç è¾¹æ¡†: borderStyle="single"
- æ ‡ç­¾åŠ ç²—: bold

#### âœ… å…¼å®¹æ€§

- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… React Hooks ä¼˜åŒ–
- âœ… Ink ç»„ä»¶ç³»ç»Ÿå…¼å®¹

#### ğŸ“š æ–°å¢æ–‡æ¡£

1. **ä½¿ç”¨æŒ‡å—** (`docs/message-component-usage.md`)
   - è¯¦ç»† API æ–‡æ¡£
   - ä½¿ç”¨ç¤ºä¾‹
   - å®é™…åº”ç”¨åœºæ™¯
   - æ€§èƒ½ä¼˜åŒ–å»ºè®®

2. **å¢å¼ºæŠ¥å‘Š** (`docs/message-component-enhancement.md`)
   - æŠ€æœ¯å®ç°ç»†èŠ‚
   - å†…éƒ¨ç»„ä»¶è¯´æ˜
   - é¢œè‰²æ–¹æ¡ˆè¯´æ˜
   - å˜æ›´ç»Ÿè®¡

3. **å¿«é€Ÿå‚è€ƒ** (`docs/message-component-quick-reference.md`)
   - é€ŸæŸ¥è¡¨æ ¼
   - å¸¸è§åœºæ™¯
   - ä»£ç ç‰‡æ®µ
   - è°ƒè¯•æŠ€å·§

4. **æ¼”ç¤ºç¨‹åº** (`examples/message-demo.tsx`)
   - 10+ å®é™…ç¤ºä¾‹
   - è‡ªåŠ¨å¾ªç¯æ¼”ç¤º
   - å¯è¿è¡Œä»£ç 
   - è¿è¡Œå‘½ä»¤: `npx tsx examples/message-demo.tsx`

---

## ğŸ“ å®Œæ•´å˜æ›´åˆ—è¡¨

### ä¿®æ”¹çš„æ–‡ä»¶

#### `src/ui/components/Message.tsx`
```diff
- 38 è¡ŒåŸºç¡€å®ç°
+ 389 è¡Œå®Œæ•´å®ç°

- åŸºç¡€æ¶ˆæ¯æ˜¾ç¤º
+ æµå¼æ¸²æŸ“
+ Markdown è§£æ
+ ä»£ç é«˜äº®
+ å·¥å…·è°ƒç”¨æ˜¾ç¤º
+ å¤šè§’è‰²æ”¯æŒ
+ å¤åˆ¶æç¤º
```

### æ–°å¢çš„æ–‡ä»¶

1. `docs/message-component-usage.md` - ä½¿ç”¨æ–‡æ¡£
2. `docs/message-component-enhancement.md` - å¢å¼ºæŠ¥å‘Š
3. `docs/message-component-quick-reference.md` - å¿«é€Ÿå‚è€ƒ
4. `examples/message-demo.tsx` - æ¼”ç¤ºç¨‹åº
5. `CHANGELOG-message-component.md` - æœ¬æ–‡ä»¶

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•
```tsx
<Message
  role="assistant"
  content="ä½ å¥½ï¼æˆ‘æ˜¯ Claudeã€‚"
  timestamp={new Date()}
/>
```

### æµå¼æ¸²æŸ“
```tsx
<Message
  role="assistant"
  content={streamingText}
  streaming={true}
  streamSpeed={20}
  onComplete={() => console.log('å®Œæˆ')}
/>
```

### Markdown
```tsx
<Message
  role="assistant"
  content={`
# æ ‡é¢˜
- åˆ—è¡¨é¡¹
\`\`\`js
code
\`\`\`
  `}
/>
```

### å·¥å…·è°ƒç”¨
```tsx
<Message
  role="assistant"
  content={[
    { type: 'text', text: 'ä½¿ç”¨å·¥å…·...' },
    { type: 'tool_use', name: 'Read', input: {...} },
    { type: 'tool_result', content: 'ç»“æœ' }
  ]}
/>
```

---

## âš ï¸ å·²çŸ¥é™åˆ¶

1. ä»£ç é«˜äº®ä»…ä½¿ç”¨å•è‰²ï¼ˆInk é™åˆ¶ï¼‰
2. ä¸æ”¯æŒå¤æ‚ Markdownï¼ˆè¡¨æ ¼ã€é“¾æ¥ã€å›¾ç‰‡ï¼‰
3. å›¾ç‰‡ä»…æ˜¾ç¤ºæ–‡æœ¬å ä½ç¬¦ï¼ˆç»ˆç«¯é™åˆ¶ï¼‰
4. å¤åˆ¶åŠŸèƒ½ä¾èµ–ç»ˆç«¯æ¨¡æ‹Ÿå™¨

---

## ğŸ”œ æœªæ¥è®¡åˆ’

- [ ] æ¶ˆæ¯æŠ˜å /å±•å¼€ï¼ˆé•¿æ¶ˆæ¯ï¼‰
- [ ] æ”¯æŒæ›´å¤š Markdown è¯­æ³•
- [ ] æ¶ˆæ¯æœç´¢åŠŸèƒ½
- [ ] æ¶ˆæ¯å¯¼å‡ºï¼ˆJSON/Markdownï¼‰
- [ ] è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- [ ] æ¶ˆæ¯ååº”/è¯„åˆ†

---

## ğŸ™ è‡´è°¢

åŸºäºå®˜æ–¹ Claude Code CLI v2.0.76 çš„è®¾è®¡å’Œ APIã€‚

---

## ğŸ“ æ”¯æŒ

- ğŸ“– æŸ¥çœ‹æ–‡æ¡£: `docs/message-component-*.md`
- ğŸ§ª è¿è¡Œæ¼”ç¤º: `npx tsx examples/message-demo.tsx`
- ğŸ› æŠ¥å‘Šé—®é¢˜: GitHub Issues

---

**å˜æ›´å®Œæˆ** âœ…
