# 代理上下文继承系统

## 概述

代理上下文继承系统为 Claude Code 提供了完整的代理间上下文传递、过滤、压缩和隔离功能。允许子代理访问父代理的上下文，同时提供灵活的配置选项来控制继承行为。

## 核心功能

### 1. 上下文传递
- **对话历史继承**：子代理可以访问完整的对话历史
- **文件上下文继承**：传递已读取的文件信息和内容
- **工具结果继承**：传递工具执行的结果
- **环境变量继承**：传递环境配置

### 2. 上下文过滤
- **选择性传递**：可以选择只传递特定类型的上下文
- **敏感信息过滤**：自动检测和过滤敏感数据（API keys, passwords等）
- **自定义过滤器**：支持自定义过滤逻辑

### 3. 上下文压缩
- **自动摘要**：将长对话历史压缩为摘要
- **Token 优化**：智能压缩以满足 token 限制
- **多级压缩**：支持不同级别的压缩策略

### 4. 上下文隔离
- **沙箱环境**：为代理创建隔离的执行环境
- **资源限制**：限制 token 使用、文件访问等
- **工具权限控制**：允许/拒绝特定工具的使用

## 使用示例

参见 `context.example.ts` 获取完整的使用示例。

## 相关文件

- `/src/agents/context.ts` - 核心实现 (1285 行)
- `/src/agents/context.example.ts` - 使用示例
- `/src/context/index.ts` - 基础上下文管理
- `/src/tools/agent.ts` - 代理工具
