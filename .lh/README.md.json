{
    "sourceFile": "README.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1767066289887,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1767066333213,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,6 @@\n # The world needs an open-source Claude Code.\r\n+\r\n A reverse-engineered restoration based on `@anthropic-ai/claude-code` v2.0.76.\r\n \r\n **For educational and research purposes only.**\r\n \r\n@@ -73,14 +74,14 @@\n ```\r\n \r\n ### Environment Variables\r\n \r\n-| Variable | Description | Default |\r\n-|----------|-------------|---------|\r\n-| `ANTHROPIC_API_KEY` | API Key | - |\r\n-| `BASH_MAX_OUTPUT_LENGTH` | Max Bash output length | 30000 |\r\n-| `CLAUDE_CODE_MAX_OUTPUT_TOKENS` | Max output tokens | 32000 |\r\n-| `CLAUDE_TELEMETRY_ENABLED` | Enable telemetry | true |\r\n+| Variable                        | Description            | Default |\r\n+| ------------------------------- | ---------------------- | ------- |\r\n+| `ANTHROPIC_API_KEY`             | API Key                | -       |\r\n+| `BASH_MAX_OUTPUT_LENGTH`        | Max Bash output length | 30000   |\r\n+| `CLAUDE_CODE_MAX_OUTPUT_TOKENS` | Max output tokens      | 32000   |\r\n+| `CLAUDE_TELEMETRY_ENABLED`      | Enable telemetry       | true    |\r\n \r\n ## Project Structure\r\n \r\n ```\r\n@@ -185,42 +186,42 @@\n ```\r\n \r\n ## Implemented Tools (25+)\r\n \r\n-| Tool | Status | Description |\r\n-|------|--------|-------------|\r\n-| **File Operations** | | |\r\n-| Read | ✅ Complete | File reading with image/PDF/Notebook support + external modification detection |\r\n-| Write | ✅ Complete | File writing with overwrite protection |\r\n-| Edit | ✅ Complete | File editing (string replacement) |\r\n-| MultiEdit | ✅ Complete | Batch file editing (atomic operations) |\r\n-| **Search & Discovery** | | |\r\n-| Glob | ✅ Complete | File pattern matching |\r\n-| Grep | ✅ Complete | Content search (ripgrep-based) with official output format |\r\n-| **Execution** | | |\r\n-| Bash | ✅ Complete | Command execution with background & sandbox support |\r\n-| TaskOutput | ✅ Complete | Get background command/agent output (unified UUID/task_id format) |\r\n-| KillShell | ✅ Complete | Terminate background processes |\r\n-| **Web Access** | | |\r\n-| WebFetch | ✅ Complete | Web page fetching with caching |\r\n-| WebSearch | ⚠️ Needs config | Web search (requires API configuration) |\r\n-| **Task Management** | | |\r\n-| TodoWrite | ✅ Complete | Task management with auto-reminder system |\r\n-| Task | ✅ Complete | Sub-agents (explore, plan, guide, etc.) |\r\n-| **Planning** | | |\r\n-| EnterPlanMode | ✅ Complete | Enter plan mode with permission system |\r\n-| ExitPlanMode | ✅ Complete | Exit plan mode |\r\n-| **Interaction** | | |\r\n-| AskUserQuestion | ✅ Complete | Ask user questions (multiSelect, options, validation) |\r\n-| **Code Tools** | | |\r\n-| NotebookEdit | ✅ Complete | Jupyter Notebook cell editing (replace/insert/delete) |\r\n-| LSP* | ✅ Complete | Language Server Protocol integration (diagnostics, hover, references) |\r\n-| **Integration** | | |\r\n-| ListMcpResources | ✅ Complete | List MCP resources |\r\n-| ReadMcpResource | ✅ Complete | Read MCP resource |\r\n-| Skill | ✅ Complete | Skill system with args parameter and permission checks |\r\n-| **Terminal** | | |\r\n-| Tmux | ✅ Complete | Multi-terminal session management (Linux/macOS) |\r\n+| Tool                   | Status         | Description                                                                    |\r\n+| ---------------------- | -------------- | ------------------------------------------------------------------------------ |\r\n+| **File Operations**    |                |                                                                                |\r\n+| Read                   | ✅ Complete     | File reading with image/PDF/Notebook support + external modification detection |\r\n+| Write                  | ✅ Complete     | File writing with overwrite protection                                         |\r\n+| Edit                   | ✅ Complete     | File editing (string replacement)                                              |\r\n+| MultiEdit              | ✅ Complete     | Batch file editing (atomic operations)                                         |\r\n+| **Search & Discovery** |                |                                                                                |\r\n+| Glob                   | ✅ Complete     | File pattern matching                                                          |\r\n+| Grep                   | ✅ Complete     | Content search (ripgrep-based) with official output format                     |\r\n+| **Execution**          |                |                                                                                |\r\n+| Bash                   | ✅ Complete     | Command execution with background & sandbox support                            |\r\n+| TaskOutput             | ✅ Complete     | Get background command/agent output (unified UUID/task_id format)              |\r\n+| KillShell              | ✅ Complete     | Terminate background processes                                                 |\r\n+| **Web Access**         |                |                                                                                |\r\n+| WebFetch               | ✅ Complete     | Web page fetching with caching                                                 |\r\n+| WebSearch              | ⚠️ Needs config | Web search (requires API configuration)                                        |\r\n+| **Task Management**    |                |                                                                                |\r\n+| TodoWrite              | ✅ Complete     | Task management with auto-reminder system                                      |\r\n+| Task                   | ✅ Complete     | Sub-agents (explore, plan, guide, etc.)                                        |\r\n+| **Planning**           |                |                                                                                |\r\n+| EnterPlanMode          | ✅ Complete     | Enter plan mode with permission system                                         |\r\n+| ExitPlanMode           | ✅ Complete     | Exit plan mode                                                                 |\r\n+| **Interaction**        |                |                                                                                |\r\n+| AskUserQuestion        | ✅ Complete     | Ask user questions (multiSelect, options, validation)                          |\r\n+| **Code Tools**         |                |                                                                                |\r\n+| NotebookEdit           | ✅ Complete     | Jupyter Notebook cell editing (replace/insert/delete)                          |\r\n+| LSP*                   | ✅ Complete     | Language Server Protocol integration (diagnostics, hover, references)          |\r\n+| **Integration**        |                |                                                                                |\r\n+| ListMcpResources       | ✅ Complete     | List MCP resources                                                             |\r\n+| ReadMcpResource        | ✅ Complete     | Read MCP resource                                                              |\r\n+| Skill                  | ✅ Complete     | Skill system with args parameter and permission checks                         |\r\n+| **Terminal**           |                |                                                                                |\r\n+| Tmux                   | ✅ Complete     | Multi-terminal session management (Linux/macOS)                                |\r\n \r\n *LSP tools available when language servers are configured\r\n \r\n ## Features\r\n@@ -520,29 +521,29 @@\n - ✅ **NotebookEdit insert mode** - Fixed cell insertion position logic\r\n \r\n ## Comparison with Official Version\r\n \r\n-| Component | Status | Notes |\r\n-|-----------|--------|-------|\r\n-| **Core Architecture** | ✅ 100% | Three-layer design (Entry → Engine → Tools) |\r\n-| **CLI Interface** | ✅ 100% | All commands & flags implemented |\r\n-| **Tool System** | ✅ 100% | 25+ tools with full feature parity |\r\n-| **API Client** | ✅ 100% | Streaming, retry, cost calculation |\r\n-| **Permission System** | ✅ 100% | Accept/bypass/plan modes |\r\n-| **Error Handling** | ✅ 100% | Tool-level retry with exponential backoff |\r\n-| **File Operations** | ✅ 100% | External modification detection |\r\n-| **Background Tasks** | ✅ 100% | Unified UUID/task_id format |\r\n-| **Output Formatting** | ✅ 100% | Grep, LSP, and all tools match official |\r\n-| **Sandbox** | ✅ 100% | Bubblewrap isolation (Linux) |\r\n-| **Hooks** | ✅ 100% | Complete event system |\r\n-| **MCP** | ✅ 100% | Full protocol support |\r\n-| **UI Components** | ✅ 100% | Ink/React framework with auto-scroll |\r\n-| **Skills/Commands** | ✅ 100% | Args, permissions, discovery |\r\n-| **Authentication** | ✅ 100% | API Key + OAuth |\r\n-| **Session Management** | ✅ 100% | Persistence, recovery, export |\r\n-| **Context Management** | ✅ 100% | Auto-summarization |\r\n-| **Code Parser** | ✅ 100% | Tree-sitter WASM |\r\n-| **Telemetry** | ✅ 100% | Local analytics |\r\n+| Component              | Status | Notes                                       |\r\n+| ---------------------- | ------ | ------------------------------------------- |\r\n+| **Core Architecture**  | ✅ 100% | Three-layer design (Entry → Engine → Tools) |\r\n+| **CLI Interface**      | ✅ 100% | All commands & flags implemented            |\r\n+| **Tool System**        | ✅ 100% | 25+ tools with full feature parity          |\r\n+| **API Client**         | ✅ 100% | Streaming, retry, cost calculation          |\r\n+| **Permission System**  | ✅ 100% | Accept/bypass/plan modes                    |\r\n+| **Error Handling**     | ✅ 100% | Tool-level retry with exponential backoff   |\r\n+| **File Operations**    | ✅ 100% | External modification detection             |\r\n+| **Background Tasks**   | ✅ 100% | Unified UUID/task_id format                 |\r\n+| **Output Formatting**  | ✅ 100% | Grep, LSP, and all tools match official     |\r\n+| **Sandbox**            | ✅ 100% | Bubblewrap isolation (Linux)                |\r\n+| **Hooks**              | ✅ 100% | Complete event system                       |\r\n+| **MCP**                | ✅ 100% | Full protocol support                       |\r\n+| **UI Components**      | ✅ 100% | Ink/React framework with auto-scroll        |\r\n+| **Skills/Commands**    | ✅ 100% | Args, permissions, discovery                |\r\n+| **Authentication**     | ✅ 100% | API Key + OAuth                             |\r\n+| **Session Management** | ✅ 100% | Persistence, recovery, export               |\r\n+| **Context Management** | ✅ 100% | Auto-summarization                          |\r\n+| **Code Parser**        | ✅ 100% | Tree-sitter WASM                            |\r\n+| **Telemetry**          | ✅ 100% | Local analytics                             |\r\n \r\n **Overall Accuracy: ~100%** (based on public API and behavioral analysis)\r\n \r\n ## Development\r\n"
                }
            ],
            "date": 1767066289887,
            "name": "Commit-0",
            "content": "# The world needs an open-source Claude Code.\r\nA reverse-engineered restoration based on `@anthropic-ai/claude-code` v2.0.76.\r\n\r\n**For educational and research purposes only.**\r\n\r\n## Disclaimer\r\n\r\nThis is an educational project for studying and learning CLI tool architecture design. This is **NOT** the official Claude Code source code, but a reimplementation based on public APIs and type definitions.\r\n\r\nFor the official Claude Code, please install the official version:\r\n```bash\r\nnpm install -g @anthropic-ai/claude-code\r\n```\r\n\r\n## Installation\r\n\r\n```bash\r\n# Install dependencies\r\nnpm install\r\n\r\n# Build the project\r\nnpm run build\r\n\r\n# Link globally (optional)\r\nnpm link\r\n```\r\n\r\n## Usage\r\n\r\n```bash\r\n# Interactive mode\r\nnpm run dev\r\n\r\n# Or run after building\r\nnode dist/cli.js\r\n\r\n# With initial prompt\r\nnode dist/cli.js \"Hello, please analyze this project\"\r\n\r\n# Print mode\r\nnode dist/cli.js -p \"Explain this code\"\r\n\r\n# Specify model\r\nnode dist/cli.js -m opus \"Complex task\"\r\n\r\n# Resume last session\r\nnode dist/cli.js --resume\r\n```\r\n\r\n## Configuration\r\n\r\nSet up your API key:\r\n\r\n**Linux/macOS:**\r\n```bash\r\nexport ANTHROPIC_API_KEY=your-api-key\r\n# or\r\nexport CLAUDE_API_KEY=your-api-key\r\n```\r\n\r\n**Windows Command Prompt:**\r\n```cmd\r\nset ANTHROPIC_API_KEY=your-api-key\r\n# or\r\nset CLAUDE_API_KEY=your-api-key\r\n```\r\n\r\n**Windows PowerShell:**\r\n```powershell\r\n$env:ANTHROPIC_API_KEY=\"your-api-key\"\r\n# or\r\n$env:CLAUDE_API_KEY=\"your-api-key\"\r\n```\r\n\r\n### Environment Variables\r\n\r\n| Variable | Description | Default |\r\n|----------|-------------|---------|\r\n| `ANTHROPIC_API_KEY` | API Key | - |\r\n| `BASH_MAX_OUTPUT_LENGTH` | Max Bash output length | 30000 |\r\n| `CLAUDE_CODE_MAX_OUTPUT_TOKENS` | Max output tokens | 32000 |\r\n| `CLAUDE_TELEMETRY_ENABLED` | Enable telemetry | true |\r\n\r\n## Project Structure\r\n\r\n```\r\nsrc/\r\n├── index.ts                # Main export barrel\r\n├── cli.ts                  # CLI entry point (Commander.js)\r\n├── core/                   # Core engine\r\n│   ├── client.ts           # Anthropic API client (streaming, retry, cost)\r\n│   ├── session.ts          # Session state management\r\n│   ├── loop.ts             # Conversation orchestrator\r\n│   └── context.ts          # Context management & summarization\r\n├── tools/                  # 25+ tools\r\n│   ├── bash.ts             # Bash execution (sandbox support)\r\n│   ├── file.ts             # Read/Write/Edit/MultiEdit\r\n│   ├── search.ts           # Glob/Grep search\r\n│   ├── web.ts              # WebFetch/WebSearch\r\n│   ├── todo.ts             # TodoWrite task management\r\n│   ├── agent.ts            # Task/TaskOutput sub-agents\r\n│   ├── notebook.ts         # Jupyter Notebook editing\r\n│   ├── planmode.ts         # EnterPlanMode/ExitPlanMode\r\n│   ├── mcp.ts              # MCP protocol (ListMcpResources/ReadMcpResource)\r\n│   ├── ask.ts              # AskUserQuestion\r\n│   ├── tmux.ts             # Tmux multi-terminal (Linux/macOS)\r\n│   ├── skill.ts            # Skill system\r\n│   ├── lsp.ts              # LSP integration (diagnostics, hover, references)\r\n│   └── sandbox.ts          # Bubblewrap sandbox (Linux)\r\n├── ui/                     # Ink/React UI framework\r\n│   ├── App.tsx             # Main app component\r\n│   └── components/         # Reusable UI components\r\n│       ├── Spinner.tsx\r\n│       ├── Message.tsx\r\n│       ├── ToolCall.tsx\r\n│       ├── TodoList.tsx\r\n│       ├── PermissionPrompt.tsx\r\n│       └── StatusBar.tsx\r\n├── agents/                 # Specialized sub-agents\r\n│   ├── explore.ts          # Codebase exploration agent\r\n│   ├── plan.ts             # Implementation planning agent\r\n│   └── guide.ts            # Claude Code documentation agent\r\n├── auth/                   # Authentication\r\n│   ├── oauth.ts            # OAuth flow\r\n│   └── api-key.ts          # API key management\r\n├── session/                # Session persistence\r\n│   ├── manager.ts          # Session lifecycle\r\n│   ├── storage.ts          # Disk persistence (~/.claude/sessions/)\r\n│   └── export.ts           # Markdown export\r\n├── context/                # Context management\r\n│   ├── estimator.ts        # Token estimation\r\n│   ├── compressor.ts       # Message summarization\r\n│   └── budget.ts           # Token budget tracking\r\n├── parser/                 # Code parsing\r\n│   ├── tree-sitter.ts      # Tree-sitter WASM integration\r\n│   └── languages/          # Language-specific parsers\r\n├── search/                 # Search utilities\r\n│   ├── ripgrep.ts          # Vendored ripgrep binary\r\n│   └── glob.ts             # File pattern matching\r\n├── hooks/                  # Hook system\r\n│   ├── registry.ts         # Hook registration\r\n│   └── executor.ts         # Hook execution\r\n├── mcp/                    # MCP protocol\r\n│   ├── client.ts           # MCP client\r\n│   ├── server.ts           # MCP server connection\r\n│   └── registry.ts         # MCP server registry\r\n├── permissions/            # Permission system\r\n│   ├── manager.ts          # Permission requests\r\n│   └── modes.ts            # Permission modes (accept/bypass/plan)\r\n├── config/                 # Configuration\r\n│   ├── loader.ts           # Load from ~/.claude/settings.json\r\n│   └── env.ts              # Environment variable handling\r\n├── telemetry/              # Telemetry\r\n│   ├── collector.ts        # Event collection\r\n│   └── analytics.ts        # Local analytics (not uploaded)\r\n├── skills/                 # Skills system\r\n│   ├── loader.ts           # Load from ~/.claude/skills/\r\n│   └── registry.ts         # Skill registration\r\n├── commands/               # Slash commands\r\n│   ├── registry.ts         # Command registration\r\n│   └── builtin/            # Built-in commands (/help, /clear, etc.)\r\n├── plugins/                # Plugin system\r\n│   ├── manager.ts          # Plugin lifecycle\r\n│   └── loader.ts           # Plugin discovery\r\n├── models/                 # Model configuration\r\n│   ├── registry.ts         # Model definitions\r\n│   └── pricing.ts          # Token pricing\r\n├── network/                # Network utilities\r\n│   ├── proxy.ts            # Proxy support\r\n│   └── retry.ts            # Retry logic\r\n├── streaming/              # Streaming I/O\r\n│   ├── parser.ts           # JSON message streaming\r\n│   └── writer.ts           # Stream writing\r\n├── security/               # Security features\r\n│   ├── validator.ts        # Input validation\r\n│   └── sanitizer.ts        # Output sanitization\r\n├── types/                  # TypeScript definitions\r\n│   ├── tools.ts            # Tool types\r\n│   ├── session.ts          # Session types\r\n│   └── config.ts           # Configuration types\r\n└── utils/                  # Utility functions\r\n    ├── fs.ts               # File system helpers\r\n    ├── path.ts             # Path utilities\r\n    └── time.ts             # Time formatting\r\n```\r\n\r\n## Implemented Tools (25+)\r\n\r\n| Tool | Status | Description |\r\n|------|--------|-------------|\r\n| **File Operations** | | |\r\n| Read | ✅ Complete | File reading with image/PDF/Notebook support + external modification detection |\r\n| Write | ✅ Complete | File writing with overwrite protection |\r\n| Edit | ✅ Complete | File editing (string replacement) |\r\n| MultiEdit | ✅ Complete | Batch file editing (atomic operations) |\r\n| **Search & Discovery** | | |\r\n| Glob | ✅ Complete | File pattern matching |\r\n| Grep | ✅ Complete | Content search (ripgrep-based) with official output format |\r\n| **Execution** | | |\r\n| Bash | ✅ Complete | Command execution with background & sandbox support |\r\n| TaskOutput | ✅ Complete | Get background command/agent output (unified UUID/task_id format) |\r\n| KillShell | ✅ Complete | Terminate background processes |\r\n| **Web Access** | | |\r\n| WebFetch | ✅ Complete | Web page fetching with caching |\r\n| WebSearch | ⚠️ Needs config | Web search (requires API configuration) |\r\n| **Task Management** | | |\r\n| TodoWrite | ✅ Complete | Task management with auto-reminder system |\r\n| Task | ✅ Complete | Sub-agents (explore, plan, guide, etc.) |\r\n| **Planning** | | |\r\n| EnterPlanMode | ✅ Complete | Enter plan mode with permission system |\r\n| ExitPlanMode | ✅ Complete | Exit plan mode |\r\n| **Interaction** | | |\r\n| AskUserQuestion | ✅ Complete | Ask user questions (multiSelect, options, validation) |\r\n| **Code Tools** | | |\r\n| NotebookEdit | ✅ Complete | Jupyter Notebook cell editing (replace/insert/delete) |\r\n| LSP* | ✅ Complete | Language Server Protocol integration (diagnostics, hover, references) |\r\n| **Integration** | | |\r\n| ListMcpResources | ✅ Complete | List MCP resources |\r\n| ReadMcpResource | ✅ Complete | Read MCP resource |\r\n| Skill | ✅ Complete | Skill system with args parameter and permission checks |\r\n| **Terminal** | | |\r\n| Tmux | ✅ Complete | Multi-terminal session management (Linux/macOS) |\r\n\r\n*LSP tools available when language servers are configured\r\n\r\n## Features\r\n\r\n### OAuth Authentication\r\n\r\nSupports both API Key and OAuth authentication:\r\n\r\n```typescript\r\nimport { initAuth, startOAuthLogin, setApiKey } from './auth';\r\n\r\n// Using API Key\r\nsetApiKey('your-api-key', true); // true for persistence\r\n\r\n// Or using OAuth login\r\nawait startOAuthLogin({\r\n  clientId: 'your-client-id',\r\n  scope: ['read', 'write'],\r\n});\r\n```\r\n\r\n### Session Persistence & Recovery\r\n\r\nAutomatic conversation saving and restoration:\r\n\r\n```typescript\r\nimport { SessionManager, listSessions, loadSession } from './session';\r\n\r\nconst manager = new SessionManager({ autoSave: true });\r\n\r\n// Start new session or resume\r\nconst session = manager.start({\r\n  model: 'claude-sonnet-4-20250514',\r\n  resume: true, // Try to resume last session\r\n});\r\n\r\n// List all sessions\r\nconst sessions = listSessions({ limit: 10 });\r\n\r\n// Export as Markdown\r\nconst markdown = manager.export();\r\n```\r\n\r\n### Context Management\r\n\r\nIntelligent context compression and summarization:\r\n\r\n```typescript\r\nimport { ContextManager, estimateTokens } from './context';\r\n\r\nconst context = new ContextManager({\r\n  maxTokens: 180000,\r\n  summarizeThreshold: 0.7, // Start compressing at 70%\r\n  keepRecentMessages: 10,\r\n});\r\n\r\n// Add conversation turn\r\ncontext.addTurn(userMessage, assistantMessage);\r\n\r\n// Get optimized messages\r\nconst messages = context.getMessages();\r\n\r\n// Manual compaction\r\ncontext.compact();\r\n```\r\n\r\n### Code Parser\r\n\r\nMulti-language code analysis support:\r\n\r\n```typescript\r\nimport { parseFile, parseCode, detectLanguage } from './parser';\r\n\r\n// Detect language\r\nconst lang = detectLanguage('app.tsx'); // 'typescript'\r\n\r\n// Parse file\r\nconst parsed = parseFile('/path/to/file.ts');\r\nconsole.log(parsed.classes);    // Class definitions\r\nconsole.log(parsed.functions);  // Function definitions\r\nconsole.log(parsed.imports);    // Import statements\r\nconsole.log(parsed.exports);    // Export statements\r\n```\r\n\r\nSupported languages: JavaScript, TypeScript, Python, Go, Rust, Java, C/C++, Ruby, PHP, Swift, Kotlin, Scala, etc.\r\n\r\n### Vendored Ripgrep\r\n\r\nBuilt-in ripgrep support, no system installation required:\r\n\r\n```typescript\r\nimport { search, listFiles, getRipgrepVersion } from './search/ripgrep';\r\n\r\n// Search content\r\nconst results = await search({\r\n  pattern: 'function.*async',\r\n  glob: '*.ts',\r\n  ignoreCase: true,\r\n});\r\n\r\n// List files\r\nconst files = await listFiles({\r\n  glob: '**/*.tsx',\r\n  hidden: false,\r\n});\r\n```\r\n\r\n### Telemetry & Analytics\r\n\r\nLocal usage statistics (data is not uploaded):\r\n\r\n```typescript\r\nimport { telemetry, getTelemetryStats } from './telemetry';\r\n\r\n// Record session\r\ntelemetry.startSession('claude-sonnet-4-20250514');\r\ntelemetry.recordMessage('user', 100);\r\ntelemetry.recordToolCall('Bash', true, 50);\r\ntelemetry.endSession();\r\n\r\n// Get statistics\r\nconst stats = getTelemetryStats();\r\nconsole.log(stats.totalSessions);\r\nconsole.log(stats.totalTokens);\r\n```\r\n\r\n### Ink/React UI Framework\r\n\r\nComplete terminal UI component system:\r\n- `Spinner` - Loading animations\r\n- `ToolCall` - Tool call display\r\n- `Message` - Message display\r\n- `Input` - Input box\r\n- `Header` - Header bar\r\n- `TodoList` - Task list\r\n- `PermissionPrompt` - Permission confirmation\r\n- `StatusBar` - Status bar\r\n\r\n### Sandbox Support (Bubblewrap)\r\n\r\n**Linux only:** If `bubblewrap` is installed, Bash commands will execute in a sandbox for enhanced security:\r\n\r\n```bash\r\n# Ubuntu/Debian\r\nsudo apt install bubblewrap\r\n\r\n# Arch Linux\r\nsudo pacman -S bubblewrap\r\n```\r\n\r\n**Note for Windows/macOS users:**\r\n- Bubblewrap sandbox is only available on Linux\r\n- Windows and macOS users can use WSL (Windows Subsystem for Linux) to enable sandbox support\r\n- Alternatively, commands will run without sandboxing (use with caution)\r\n\r\nSandbox can be disabled with `dangerouslyDisableSandbox: true` parameter.\r\n\r\n### Hooks System\r\n\r\nExecute custom scripts before/after tool calls:\r\n\r\n```json\r\n// .claude/settings.json\r\n{\r\n  \"hooks\": [\r\n    {\r\n      \"event\": \"PreToolUse\",\r\n      \"matcher\": \"Bash\",\r\n      \"command\": \"/path/to/script.sh\",  // Linux/macOS: .sh, Windows: .bat or .ps1\r\n      \"blocking\": true\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nSupported events:\r\n- `PreToolUse` - Before tool call\r\n- `PostToolUse` - After tool call\r\n- `PrePromptSubmit` - Before submission\r\n- `PostPromptSubmit` - After submission\r\n- `Notification` - Notifications\r\n- `Stop` - Stop\r\n\r\n### MCP Protocol Support\r\n\r\nConnect to MCP (Model Context Protocol) servers:\r\n\r\n```json\r\n// .claude/settings.json\r\n{\r\n  \"mcpServers\": {\r\n    \"filesystem\": {\r\n      \"type\": \"stdio\",\r\n      \"command\": \"npx\",\r\n      \"args\": [\"-y\", \"@modelcontextprotocol/server-filesystem\", \"/path\"]  // Use absolute path\r\n    }\r\n  }\r\n}\r\n```\r\n\r\n**Path examples:**\r\n- Linux/macOS: `\"/home/user/projects\"` or `\"/Users/user/projects\"`\r\n- Windows: `\"C:\\\\Users\\\\user\\\\projects\"` (use double backslashes in JSON)\r\n\r\n### Tmux Multi-terminal\r\n\r\n**Linux/macOS only:** Manage multiple terminal sessions:\r\n```javascript\r\n// Create session\r\n{ action: \"new\", session_name: \"dev-server\" }\r\n\r\n// Send command\r\n{ action: \"send\", session_name: \"dev-server\", command: \"npm run dev\" }\r\n\r\n// Capture output\r\n{ action: \"capture\", session_name: \"dev-server\" }\r\n```\r\n\r\n**Note for Windows users:**\r\n- Tmux is not available natively on Windows\r\n- Use WSL (Windows Subsystem for Linux) to access Tmux\r\n- Alternative: Use Windows Terminal with multiple tabs/panes\r\n\r\n### Skills & Custom Commands\r\n\r\nLoad from the following directories:\r\n- **Linux/macOS:** `~/.claude/skills/` and `.claude/commands/`\r\n- **Windows:** `%USERPROFILE%\\.claude\\skills\\` and `.claude\\commands\\`\r\n\r\nFeatures:\r\n- Skills: Reusable prompt templates\r\n- Slash Commands: Custom command extensions\r\n\r\n### Enhanced API Client\r\n\r\n- Exponential backoff retry (up to 4 times)\r\n- Automatic cost calculation\r\n- Token usage statistics\r\n- Multi-model pricing support\r\n\r\n## Slash Commands\r\n\r\n- `/help` - Show help\r\n- `/clear` - Clear conversation history\r\n- `/save` - Save session\r\n- `/stats` - Show statistics\r\n- `/tools` - List tools\r\n- `/model` - Switch model\r\n- `/resume` - Resume session\r\n- `/compact` - Compress context\r\n- `/exit` - Exit\r\n\r\n## Testing\r\n\r\nThis project includes comprehensive testing:\r\n\r\n```bash\r\n# Run all tests\r\nnpm test\r\n\r\n# Run with UI\r\nnpm run test:ui\r\n\r\n# Run specific test suites\r\nnpm run test:unit          # Unit tests\r\nnpm run test:integration   # Integration tests\r\nnpm run test:e2e          # End-to-end tests\r\n\r\n# Run with coverage\r\nnpm run test:coverage\r\n\r\n# Watch mode\r\nnpm run test:watch\r\n```\r\n\r\n### Test Structure\r\n- **Unit Tests** (`src/**/*.test.ts`) - Individual component tests\r\n- **Integration Tests** (`tests/integration/`) - Multi-component interaction tests\r\n- **E2E Tests** (`tests/e2e/`) - Full CLI workflow tests\r\n- **Tool Tests** (`tests/tools/`) - Individual tool functionality tests\r\n\r\n## Recent Improvements\r\n\r\n### v2.0.76+ Enhancements\r\n- ✅ **Tool-level error handling & retry** - Exponential backoff for transient failures\r\n- ✅ **LSP URI handling** - Enhanced URI parsing and location validation\r\n- ✅ **Grep output format** - 100% match with official implementation\r\n- ✅ **OAuth authentication** - Streamlined auth flow and system prompt formatting\r\n- ✅ **AskUserQuestion** - Full parity with official (multiSelect, validation)\r\n- ✅ **Shell ID format** - Unified UUID/task_id format across all background tasks\r\n- ✅ **Tool result persistence** - Automatic saving of tool execution results\r\n- ✅ **Permission dialog flow** - Complete permission request workflow\r\n- ✅ **TodoWrite auto-reminders** - Official reminder system for task tracking\r\n- ✅ **Plan mode permissions** - Permission checks integrated into planning tools\r\n- ✅ **File modification detection** - Alerts when files are modified externally\r\n- ✅ **Skill args parameter** - Full skill argument passing and permission system\r\n- ✅ **NotebookEdit insert mode** - Fixed cell insertion position logic\r\n\r\n## Comparison with Official Version\r\n\r\n| Component | Status | Notes |\r\n|-----------|--------|-------|\r\n| **Core Architecture** | ✅ 100% | Three-layer design (Entry → Engine → Tools) |\r\n| **CLI Interface** | ✅ 100% | All commands & flags implemented |\r\n| **Tool System** | ✅ 100% | 25+ tools with full feature parity |\r\n| **API Client** | ✅ 100% | Streaming, retry, cost calculation |\r\n| **Permission System** | ✅ 100% | Accept/bypass/plan modes |\r\n| **Error Handling** | ✅ 100% | Tool-level retry with exponential backoff |\r\n| **File Operations** | ✅ 100% | External modification detection |\r\n| **Background Tasks** | ✅ 100% | Unified UUID/task_id format |\r\n| **Output Formatting** | ✅ 100% | Grep, LSP, and all tools match official |\r\n| **Sandbox** | ✅ 100% | Bubblewrap isolation (Linux) |\r\n| **Hooks** | ✅ 100% | Complete event system |\r\n| **MCP** | ✅ 100% | Full protocol support |\r\n| **UI Components** | ✅ 100% | Ink/React framework with auto-scroll |\r\n| **Skills/Commands** | ✅ 100% | Args, permissions, discovery |\r\n| **Authentication** | ✅ 100% | API Key + OAuth |\r\n| **Session Management** | ✅ 100% | Persistence, recovery, export |\r\n| **Context Management** | ✅ 100% | Auto-summarization |\r\n| **Code Parser** | ✅ 100% | Tree-sitter WASM |\r\n| **Telemetry** | ✅ 100% | Local analytics |\r\n\r\n**Overall Accuracy: ~100%** (based on public API and behavioral analysis)\r\n\r\n## Development\r\n\r\n```bash\r\n# Development mode (using tsx)\r\nnpm run dev\r\n\r\n# Build\r\nnpm run build\r\n\r\n# Type checking\r\nnpx tsc --noEmit\r\n```\r\n\r\n## Tech Stack\r\n\r\n- **TypeScript** - Type safety\r\n- **Anthropic SDK** - API calls\r\n- **Ink + React** - Terminal UI\r\n- **Commander** - CLI framework\r\n- **Chalk** - Terminal colors\r\n- **Glob** - File matching\r\n- **Zod** - Schema validation\r\n\r\n## Community\r\n\r\n- **Discord:** [Join our Discord](https://discord.gg/hs5BWGjt)\r\n- **X (Twitter):** [@wangbingjie1989](https://x.com/wangbingjie1989)\r\n\r\n## License\r\n\r\nThis project is for educational purposes only. Original Claude Code is owned by Anthropic PBC.\r\n\r\n---\r\n\r\n*This project is a reverse engineering study of obfuscated code and does not represent the official implementation.*\r\n\r\n[中文版 README](README.zh-CN.md)\r\n"
        }
    ]
}