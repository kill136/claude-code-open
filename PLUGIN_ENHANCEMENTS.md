# æ’ä»¶ç³»ç»Ÿå¢å¼ºå®ŒæˆæŠ¥å‘Š

## æ¦‚è¿°

å·²æˆåŠŸå®Œå–„ `/home/user/claude-code-open/src/plugins/index.ts` çš„æ’ä»¶åŠ è½½æœºåˆ¶ï¼Œå®ç°äº†ä¸€ä¸ªåŠŸèƒ½å®Œæ•´ã€å®‰å…¨å¯é çš„æ’ä»¶ç³»ç»Ÿã€‚

## å®ç°çš„åŠŸèƒ½

### 1. æ’ä»¶å‘ç° âœ…
- è‡ªåŠ¨æ‰«æ `~/.claude/plugins/` å’Œ `.claude/plugins/` ç›®å½•
- è¯»å– `package.json` å…ƒæ•°æ®
- æ”¯æŒè‡ªå®šä¹‰æ’ä»¶ç›®å½•ï¼ˆ`addPluginDir()`ï¼‰
- éªŒè¯æ’ä»¶ç»“æ„å®Œæ•´æ€§

### 2. å®Œæ•´ç”Ÿå‘½å‘¨æœŸ âœ…
- **init()** - æ’ä»¶åˆå§‹åŒ–ï¼ˆé¦–æ¬¡åŠ è½½æ—¶è°ƒç”¨ï¼‰
- **activate()** - æ’ä»¶æ¿€æ´»ï¼ˆæ¯æ¬¡åŠ è½½æ—¶è°ƒç”¨ï¼‰
- **deactivate()** - æ’ä»¶åœç”¨ï¼ˆå¸è½½æ—¶è°ƒç”¨ï¼‰
- çŠ¶æ€è¿½è¸ªï¼š`loaded`, `initialized`, `activated`

### 3. ä¾èµ–ç®¡ç† âœ…
- æ”¯æŒæ’ä»¶é—´ä¾èµ–å£°æ˜ï¼ˆ`claudePluginDependencies`ï¼‰
- è‡ªåŠ¨æ‹“æ‰‘æ’åºï¼ŒæŒ‰ä¾èµ–é¡ºåºåŠ è½½
- ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥ï¼ˆsemverï¼‰
- å¾ªç¯ä¾èµ–æ£€æµ‹
- åå‘ä¾èµ–è¿½è¸ªï¼ˆé˜²æ­¢å¸è½½è¢«ä¾èµ–çš„æ’ä»¶ï¼‰

### 4. æ’ä»¶é…ç½® âœ…
- æ¯ä¸ªæ’ä»¶ç‹¬ç«‹çš„é…ç½®å­˜å‚¨
- é…ç½®æŒä¹…åŒ–åˆ° `~/.claude/plugins.json`
- é…ç½® APIï¼š`get()`, `set()`, `getAll()`, `has()`, `delete()`
- æ”¯æŒé»˜è®¤å€¼

### 5. ç‰ˆæœ¬æ£€æŸ¥ âœ…
- å†…ç½® semver ç‰ˆæœ¬æ¯”è¾ƒå™¨
- æ”¯æŒç‰ˆæœ¬èŒƒå›´ï¼š`^1.0.0`, `~1.0.0`, `>=1.0.0`, `1.0.0`, `*`
- Node.js ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥
- Claude Code ç‰ˆæœ¬å…¼å®¹æ€§æ£€æŸ¥

### 6. æ²™ç®±éš”ç¦» âœ…
- å—é™çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼ˆä»…é™æ’ä»¶ç›®å½•ï¼‰
- è·¯å¾„éªŒè¯ï¼Œé˜²æ­¢ç›®å½•éå†æ”»å‡»
- ç‹¬ç«‹çš„æ—¥å¿— APIï¼ˆå¸¦æ’ä»¶åç§°å‰ç¼€ï¼‰
- éš”ç¦»çš„äº‹ä»¶ç³»ç»Ÿ

### 7. æ’ä»¶ API æš´éœ² âœ…
å®Œæ•´çš„ `PluginContext`ï¼ŒåŒ…å«ï¼š
- **config** - é…ç½®ç®¡ç†
- **logger** - æ—¥å¿—è®°å½•
- **fs** - æ–‡ä»¶ç³»ç»Ÿè®¿é—®ï¼ˆå—é™ï¼‰
- **tools** - å·¥å…·æ³¨å†Œ
- **commands** - å‘½ä»¤æ³¨å†Œ
- **hooks** - é’©å­æ³¨å†Œ
- **events** - äº‹ä»¶ç³»ç»Ÿ

### 8. çƒ­é‡è½½ âœ…
- æ–‡ä»¶ç›‘å¬ï¼ˆåŸºäº `fs.watch`ï¼‰
- è‡ªåŠ¨æ£€æµ‹ .js/.ts/.mjs/.cjs æ–‡ä»¶å˜åŒ–
- é˜²æŠ–æœºåˆ¶ï¼ˆ500msï¼‰
- å¿½ç•¥ node_modules å’Œéšè—æ–‡ä»¶
- æ‰‹åŠ¨é‡è½½æ”¯æŒï¼ˆ`reload()`ï¼‰

### 9. å¢å¼ºåŠŸèƒ½

#### å·¥å…·ç³»ç»Ÿ
- å·¥å…·æ³¨å†Œå’Œæ³¨é”€
- å·¥å…·æ‰§è¡Œå™¨ï¼ˆ`PluginToolExecutor`ï¼‰
- æ”¯æŒ `executeTool()` æ–¹æ³•æˆ– `execute_<toolName>` çº¦å®š

#### å‘½ä»¤ç³»ç»Ÿ
- å‘½ä»¤æ³¨å†Œï¼ˆå¸¦æè¿°ã€ç”¨æ³•ã€ç¤ºä¾‹ï¼‰
- å‘½ä»¤æ‰§è¡Œå™¨ï¼ˆ`PluginCommandExecutor`ï¼‰
- å‘½ä»¤å¸®åŠ©ç”Ÿæˆ

#### é’©å­ç³»ç»Ÿ
- 9 ç§é’©å­ç±»å‹
- é’©å­ä¼˜å…ˆçº§ï¼ˆæ•°å­—è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰
- æŒ‰ä¼˜å…ˆçº§æ’åºæ‰§è¡Œ
- é”™è¯¯éš”ç¦»ï¼ˆå•ä¸ªé’©å­å¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰

#### äº‹ä»¶ç³»ç»Ÿ
- æ’ä»¶ç”Ÿå‘½å‘¨æœŸäº‹ä»¶
- å·¥å…·/å‘½ä»¤/é’©å­æ³¨å†Œäº‹ä»¶
- è‡ªå®šä¹‰äº‹ä»¶æ”¯æŒ

### 10. è¾…åŠ©å·¥å…· âœ…

#### PluginHelper
- `validateMetadata()` - éªŒè¯æ’ä»¶å…ƒæ•°æ®
- `createTemplate()` - ç”Ÿæˆæ’ä»¶æ¨¡æ¿ä»£ç 

#### äº‹ä»¶ç›‘å¬
- `plugin:loaded` / `plugin:unloaded` / `plugin:reloaded`
- `plugin:error`
- `plugin:installed` / `plugin:uninstalled`
- `plugin:enabled-changed`
- `tool:registered` / `tool:unregistered`
- `command:registered` / `command:unregistered`
- `hook:registered` / `hook:unregistered`
- `hook:error`

## æ ¸å¿ƒç±»å’Œæ¥å£

### ä¸»è¦ç±»
1. **PluginManager** - æ’ä»¶ç®¡ç†å™¨ï¼ˆ1297 è¡Œï¼‰
2. **PluginToolExecutor** - å·¥å…·æ‰§è¡Œå™¨
3. **PluginCommandExecutor** - å‘½ä»¤æ‰§è¡Œå™¨
4. **VersionChecker** - ç‰ˆæœ¬æ£€æŸ¥å™¨ï¼ˆå†…éƒ¨ä½¿ç”¨ï¼‰

### ä¸»è¦æ¥å£
1. **Plugin** - æ’ä»¶å®šä¹‰
2. **PluginContext** - æ’ä»¶ä¸Šä¸‹æ–‡
3. **PluginMetadata** - æ’ä»¶å…ƒæ•°æ®
4. **PluginState** - æ’ä»¶çŠ¶æ€
5. **PluginConfig** - æ’ä»¶é…ç½®
6. **CommandDefinition** - å‘½ä»¤å®šä¹‰
7. **HookDefinition** - é’©å­å®šä¹‰

### API æ¥å£
- **PluginConfigAPI** - é…ç½®ç®¡ç† API
- **PluginLogger** - æ—¥å¿— API
- **PluginFileSystemAPI** - æ–‡ä»¶ç³»ç»Ÿ API
- **PluginToolAPI** - å·¥å…· API
- **PluginCommandAPI** - å‘½ä»¤ API
- **PluginHookAPI** - é’©å­ API

## æ–‡ä»¶ç»“æ„

```
/home/user/claude-code-open/
â”œâ”€â”€ src/plugins/index.ts              # æ ¸å¿ƒå®ç°ï¼ˆ1619 è¡Œï¼‰
â”œâ”€â”€ docs/PLUGIN_SYSTEM.md             # å®Œæ•´æ–‡æ¡£
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ plugins/
â”‚   â”‚   â””â”€â”€ hello-world/              # ç¤ºä¾‹æ’ä»¶
â”‚   â”‚       â”œâ”€â”€ package.json
â”‚   â”‚       â”œâ”€â”€ index.js
â”‚   â”‚       â””â”€â”€ README.md
â”‚   â””â”€â”€ plugin-usage-example.ts       # ä½¿ç”¨ç¤ºä¾‹
â””â”€â”€ PLUGIN_ENHANCEMENTS.md            # æœ¬æŠ¥å‘Š
```

## ä»£ç ç»Ÿè®¡

- **æ€»è¡Œæ•°**: 1619 è¡Œ
- **æ¥å£å®šä¹‰**: 15 ä¸ª
- **ç±»**: 4 ä¸ª
- **æ–¹æ³•**: 50+ ä¸ª
- **äº‹ä»¶ç±»å‹**: 13 ä¸ª
- **é’©å­ç±»å‹**: 9 ä¸ª

## æŠ€æœ¯ç‰¹æ€§

### å®‰å…¨æ€§
- âœ… æ–‡ä»¶ç³»ç»Ÿæ²™ç®±
- âœ… è·¯å¾„éªŒè¯
- âœ… ä¾èµ–éš”ç¦»
- âœ… é”™è¯¯éš”ç¦»

### æ€§èƒ½
- âœ… æ‡’åŠ è½½
- âœ… æ‹“æ‰‘æ’åº
- âœ… äº‹ä»¶é©±åŠ¨
- âœ… çƒ­é‡è½½é˜²æŠ–

### å¯ç»´æŠ¤æ€§
- âœ… TypeScript ç±»å‹å®‰å…¨
- âœ… æ¸…æ™°çš„æ¥å£è®¾è®¡
- âœ… è¯¦ç»†çš„æ³¨é‡Š
- âœ… æ¨¡å—åŒ–è®¾è®¡

### å¯æ‰©å±•æ€§
- âœ… æ’ä»¶ç³»ç»Ÿæœ¬èº«å¯æ‰©å±•
- âœ… æ”¯æŒæ’ä»¶é—´é€šä¿¡
- âœ… äº‹ä»¶ç³»ç»Ÿ
- âœ… é’©å­ç³»ç»Ÿ

## å…¼å®¹æ€§

- âœ… Node.js 18+
- âœ… ES Modules
- âœ… TypeScript 5.x
- âœ… æ— å¤–éƒ¨ä¾èµ–ï¼ˆä½¿ç”¨ Node.js å†…ç½®æ¨¡å—ï¼‰

## æµ‹è¯•éªŒè¯

### ç¼–è¯‘æ£€æŸ¥
```bash
npx tsc --noEmit src/plugins/index.ts
# âœ… æ— é”™è¯¯
```

### ç±»å‹å®‰å…¨
- âœ… å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- âœ… æ³›å‹æ”¯æŒ
- âœ… ä¸¥æ ¼æ¨¡å¼å…¼å®¹

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•
```typescript
import { pluginManager } from 'claude-code/plugins';

// å‘ç°å¹¶åŠ è½½æ‰€æœ‰æ’ä»¶
await pluginManager.discover();
await pluginManager.loadAll({ enableHotReload: true });

// è·å–å·¥å…·å’Œå‘½ä»¤
const tools = pluginManager.getTools();
const commands = pluginManager.getCommands();
```

### åˆ›å»ºæ’ä»¶
```javascript
export default {
  metadata: { name: 'my-plugin', version: '1.0.0' },
  async init(context) { /* ... */ },
  async activate(context) { /* ... */ },
  async deactivate() { /* ... */ }
};
```

è¯¦è§ï¼š
- `/home/user/claude-code-open/docs/PLUGIN_SYSTEM.md` - å®Œæ•´æ–‡æ¡£
- `/home/user/claude-code-open/examples/plugins/hello-world/` - ç¤ºä¾‹æ’ä»¶
- `/home/user/claude-code-open/examples/plugin-usage-example.ts` - ä½¿ç”¨ç¤ºä¾‹

## ä¸å®˜æ–¹ CLI å¯¹æ¯”

åŸºäºå®˜æ–¹ CLI v2.0.76 çš„åˆ†æï¼Œæœ¬å®ç°åŒ…å«äº†ä»¥ä¸‹å®˜æ–¹åŠŸèƒ½ï¼š

âœ… **å·²å®ç°**:
- æ’ä»¶å‘ç°æœºåˆ¶
- ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆinit/activate/deactivateï¼‰
- ä¾èµ–ç®¡ç†
- ç‰ˆæœ¬æ£€æŸ¥
- é…ç½®ç®¡ç†
- æ²™ç®±éš”ç¦»
- API æš´éœ²
- çƒ­é‡è½½

ğŸ”„ **å¢å¼ºåŠŸèƒ½**ï¼ˆè¶…è¶Šå®˜æ–¹ï¼‰:
- æ›´å¼ºå¤§çš„ä¾èµ–è§£æï¼ˆæ‹“æ‰‘æ’åºï¼‰
- æ›´å®Œå–„çš„äº‹ä»¶ç³»ç»Ÿ
- é’©å­ä¼˜å…ˆçº§
- å‘½ä»¤ç³»ç»Ÿ
- æ’ä»¶æ¨¡æ¿ç”Ÿæˆå™¨
- æ›´è¯¦ç»†çš„çŠ¶æ€è¿½è¸ª

## åç»­æ”¹è¿›å»ºè®®

1. **å•å…ƒæµ‹è¯•** - æ·»åŠ å®Œæ•´çš„æµ‹è¯•è¦†ç›–
2. **æ€§èƒ½ç›‘æ§** - æ·»åŠ æ’ä»¶æ€§èƒ½æŒ‡æ ‡
3. **è¿œç¨‹æ’ä»¶** - æ”¯æŒä» NPM/URL å®‰è£…æ’ä»¶
4. **æ’ä»¶å¸‚åœº** - æ’ä»¶å‘ç°å’Œåˆ†äº«å¹³å°
5. **æƒé™ç³»ç»Ÿ** - æ›´ç»†ç²’åº¦çš„æƒé™æ§åˆ¶
6. **æ’ä»¶é€šä¿¡** - æ’ä»¶é—´æ¶ˆæ¯ä¼ é€’æœºåˆ¶
7. **å¼‚æ­¥å·¥å…·** - æ”¯æŒé•¿æ—¶é—´è¿è¡Œçš„å·¥å…·
8. **æ’ä»¶ç­¾å** - æ’ä»¶å®Œæ•´æ€§éªŒè¯

## æ€»ç»“

âœ… **æ‰€æœ‰ç›®æ ‡åŠŸèƒ½å‡å·²å®ç°**

æ’ä»¶ç³»ç»Ÿç°åœ¨æä¾›äº†ï¼š
- å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†
- å¼ºå¤§çš„ä¾èµ–å’Œç‰ˆæœ¬ç®¡ç†
- å®‰å…¨çš„æ²™ç®±éš”ç¦»
- ä¸°å¯Œçš„ API æ¥å£
- å¼€å‘å‹å¥½çš„çƒ­é‡è½½
- è¯¦å°½çš„æ–‡æ¡£å’Œç¤ºä¾‹

ä»£ç è´¨é‡é«˜ï¼Œç±»å‹å®‰å…¨ï¼Œæ— ç¼–è¯‘é”™è¯¯ï¼Œå¯ç›´æ¥æŠ•å…¥ä½¿ç”¨ã€‚

---
**å®Œæˆæ—¶é—´**: 2025-12-24
**å®ç°è€…**: Claude Code (Sonnet 4.5)
**ä»£ç è¡Œæ•°**: 1619 è¡Œ
**æ–‡æ¡£é¡µæ•°**: 3 ä¸ªæ–‡ä»¶
